/*Remote Queries*/

--Remote Opportunities by Experience Level
SELECT 
    remote_ratio,
    COUNT(case when experience_level = 'EX' then 1 end) as EX,
    COUNT(case when experience_level = 'SE' then 1 end) as SE,
    COUNT(case when experience_level = 'MI' then 1 end) as MI,
	COUNT(case when experience_level = 'EN' then 1 end) as EN
FROM dbo.ds_salaries$
WHERE company_location='US'
GROUP BY remote_ratio;

--Remote Opportunities by Company Size
SELECT 
    remote_ratio,
    COUNT(case when company_size = 'L' then 1 end) as Large,
    COUNT(case when company_size = 'M' then 1 end) as Medium,
    COUNT(case when company_size = 'S' then 1 end) as Small
FROM dbo.ds_salaries$
WHERE company_location='US'
GROUP BY remote_ratio;

--Count of Jobs by Title
SELECT 
    job_title,
	count(job_title) AS JobCount
FROM dbo.ds_salaries$
WHERE company_location='US'
GROUP BY job_title;

--Count of Jobs by Title and Remote Opportunities 
SELECT 
    job_title,
    COUNT(case when remote_ratio = 'In-Person' then 1 end) as InPerson,
    COUNT(case when remote_ratio = 'Hybrid' then 1 end) as Hyrbid,
    COUNT(case when remote_ratio = 'Virtual' then 1 end) as Virtual
FROM dbo.ds_salaries$
WHERE company_location='US'
GROUP BY job_title;

/*Salary Queries*/

--Average Salaries by Job Titles 
SELECT 
    job_title,
	AVG(salary_in_usd) as AverageSalary
FROM dbo.ds_salaries$
WHERE company_location='US'
GROUP BY job_title
ORDER by AVG(salary_in_usd)DESC

--Salary by Remote Ratio
SELECT 
    remote_ratio,
	round(AVG(salary_in_usd),2) as AverageSalary
FROM dbo.ds_salaries$
WHERE company_location='US'
GROUP BY remote_ratio
ORDER by AVG(salary_in_usd)DESC

--Salary by Company Size 
SELECT 
    company_size,
	round(AVG(salary_in_usd),2) as AverageSalary
FROM dbo.ds_salaries$
WHERE company_location='US'
GROUP BY company_size
ORDER by AVG(salary_in_usd)DESC

--Salary by Experience Level
SELECT 
    experience_level,
	round(AVG(salary_in_usd),2) as AverageSalary
FROM dbo.ds_salaries$
WHERE company_location='US'
GROUP BY experience_level
ORDER by AVG(salary_in_usd)DESC

/*Worldwide Queries*/


CREATE INDEX idx_company_location ON dbo.ds_salaries$ (company_location);
CREATE INDEX idx_job_title ON dbo.ds_salaries$ (job_title);

-- Jobs by Title and Company Locations 
--Not sure how to optimize this query since I'm trying to create a 'Pivot-Like" table. Suggestions appreciated. 
SELECT
job_title as JobTitle,
COUNT(job_title) as TotalJobCount,
COUNT(case when company_location =  'ES 'then 1 end) as ES,
COUNT(case when company_location =  'US 'then 1 end) as US,
COUNT(case when company_location =  'CA 'then 1 end) as CA,
COUNT(case when company_location =  'DE 'then 1 end) as DE,
COUNT(case when company_location =  'GB 'then 1 end) as GB,
COUNT(case when company_location =  'NG 'then 1 end) as NG,
COUNT(case when company_location =  'IN 'then 1 end) as IND,
COUNT(case when company_location =  'HK 'then 1 end) as HK,
COUNT(case when company_location =  'NL 'then 1 end) as NL,
COUNT(case when company_location =  'CH 'then 1 end) as CH,
COUNT(case when company_location =  'CF 'then 1 end) as CF,
COUNT(case when company_location =  'FR 'then 1 end) as FR,
COUNT(case when company_location =  'FI 'then 1 end) as FI,
COUNT(case when company_location =  'UA 'then 1 end) as UA,
COUNT(case when company_location =  'IE 'then 1 end) as IE,
COUNT(case when company_location =  'IL 'then 1 end) as IL,
COUNT(case when company_location =  'GH 'then 1 end) as GH,
COUNT(case when company_location =  'CO 'then 1 end) as CO,
COUNT(case when company_location =  'SG 'then 1 end) as SG,
COUNT(case when company_location =  'AU 'then 1 end) as AU,
COUNT(case when company_location =  'SE 'then 1 end) as SE,
COUNT(case when company_location =  'SI 'then 1 end) as SI,
COUNT(case when company_location =  'MX 'then 1 end) as MX,
COUNT(case when company_location =  'BR 'then 1 end) as BR,
COUNT(case when company_location =  'PT 'then 1 end) as PT,
COUNT(case when company_location =  'RU 'then 1 end) as RU,
COUNT(case when company_location =  'TH 'then 1 end) as TH,
COUNT(case when company_location =  'HR 'then 1 end) as HR,
COUNT(case when company_location =  'VN 'then 1 end) as VN,
COUNT(case when company_location =  'EE 'then 1 end) as EE,
COUNT(case when company_location =  'AM 'then 1 end) as AM,
COUNT(case when company_location =  'BA 'then 1 end) as BA,
COUNT(case when company_location =  'KE 'then 1 end) as KE,
COUNT(case when company_location =  'GR 'then 1 end) as GR,
COUNT(case when company_location =  'MK 'then 1 end) as MK,
COUNT(case when company_location =  'LV 'then 1 end) as LV,
COUNT(case when company_location =  'RO 'then 1 end) as RO,
COUNT(case when company_location =  'PK 'then 1 end) as PK,
COUNT(case when company_location =  'IT 'then 1 end) as IT,
COUNT(case when company_location =  'MA 'then 1 end) as MA,
COUNT(case when company_location =  'PL 'then 1 end) as PL,
COUNT(case when company_location =  'AL 'then 1 end) as AL,
COUNT(case when company_location =  'AR 'then 1 end) as AR,
COUNT(case when company_location =  'LT 'then 1 end) as LT,
COUNT(case when company_location =  'AS 'then 1 end) as ASM,
COUNT(case when company_location =  'CR 'then 1 end) as CR,
COUNT(case when company_location =  'IR 'then 1 end) as IR,
COUNT(case when company_location =  'BS 'then 1 end) as BS,
COUNT(case when company_location =  'HU 'then 1 end) as HU,
COUNT(case when company_location =  'AT 'then 1 end) as AUT,
COUNT(case when company_location =  'SK 'then 1 end) as SK,
COUNT(case when company_location =  'CZ 'then 1 end) as CZ,
COUNT(case when company_location =  'TR 'then 1 end) as TR,
COUNT(case when company_location =  'PR 'then 1 end) as PR,
COUNT(case when company_location =  'DK 'then 1 end) as DK,
COUNT(case when company_location =  'BO 'then 1 end) as BO,
COUNT(case when company_location =  'PH 'then 1 end) as PH,
COUNT(case when company_location =  'BE 'then 1 end) as BE,
COUNT(case when company_location =  'ID 'then 1 end) as ID,
COUNT(case when company_location =  'EG 'then 1 end) as EG,
COUNT(case when company_location =  'AE 'then 1 end) as AE,
COUNT(case when company_location =  'LU 'then 1 end) as LU,
COUNT(case when company_location =  'MY 'then 1 end) as MY,
COUNT(case when company_location =  'HN 'then 1 end) as HN,
COUNT(case when company_location =  'JP 'then 1 end) as JP,
COUNT(case when company_location =  'DZ 'then 1 end) as DZ,
COUNT(case when company_location =  'IQ 'then 1 end) as IQ,
COUNT(case when company_location =  'CN 'then 1 end) as CN,
COUNT(case when company_location =  'NZ 'then 1 end) as NZ,
COUNT(case when company_location =  'CL 'then 1 end) as CL,
COUNT(case when company_location =  'MD 'then 1 end) as MD,
COUNT(case when company_location =  'MT 'then 1 end) as MT
FROM dbo.ds_salaries$
GROUP BY job_title
ORDER BY COUNT(job_title) DESC;


-- Average Salary by Company Location
SELECT
company_location as CompanyLocation, 
round(AVG(salary_in_usd),2)as AverageSalary
FROM dbo.ds_salaries$
GROUP BY company_location
ORDER BY AVG(salary_in_usd) DESC;

--Employee Residential Count by Company Location
SELECT
employee_residence as EmployeeResidence,
count(employee_residence) as CountEmployeeResidence
FROM dbo.ds_salaries$
GROUP BY employee_residence
ORDER BY count(employee_residence)DESC;


With CTE1 as(
SELECT 
    company_location,
    COUNT(case when remote_ratio = 'In-Person' then 1 end) as InP,
    COUNT(case when remote_ratio = 'Hybrid' then 1 end) as Hyb,
    COUNT(case when remote_ratio = 'Virtual' then 1 end) as Vir,
	count(remote_ratio) as TotalCount
FROM dbo.ds_salaries$
GROUP BY company_location
) 

SELECT
company_location,
InPerson,
TotalCount,
(InPerson/TotalCount) as InPersonPerc
FROM CTE1
;


SELECT 
    company_location as CompanyLocation,
    round(CAST(COUNT(case when remote_ratio = 'In-Person' then 1 end) AS FLOAT) / COUNT(remote_ratio) * 100,2) as InPersonPercentage,
    round(CAST(COUNT(case when remote_ratio = 'Hybrid' then 1 end) AS FLOAT) / COUNT(remote_ratio) * 100,2) as HybridPercentage,
    round(CAST(COUNT(case when remote_ratio = 'Virtual' then 1 end) AS FLOAT) / COUNT(remote_ratio) * 100,2) as VirtualPercentage
FROM dbo.ds_salaries$
GROUP BY company_location
ORDER BY company_location;








































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































